"use strict";(self.webpackChunkai=self.webpackChunkai||[]).push([[967],{3905:function(e,n,t){t.d(n,{Zo:function(){return l},kt:function(){return b}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),d=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},l=function(e){var n=d(e.components);return r.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=d(t),b=a,m=u["".concat(c,".").concat(b)]||u[b]||p[b]||s;return t?r.createElement(m,o(o({ref:n},l),{},{components:t})):r.createElement(m,o({ref:n},l))}));function b(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,o=new Array(s);o[0]=u;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var d=2;d<s;d++)o[d]=t[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},2717:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return c},metadata:function(){return d},toc:function(){return l},default:function(){return u}});var r=t(7462),a=t(3366),s=(t(7294),t(3905)),o=["components"],i={sidebar_position:5},c="Increase storage size",d={unversionedId:"c4pd/increase_storage_size",id:"c4pd/increase_storage_size",isDocsHomePage:!1,title:"Increase storage size",description:"Check the current storage configuration",source:"@site/docs/c4pd/increase_storage_size.md",sourceDirName:"c4pd",slug:"/c4pd/increase_storage_size",permalink:"/ai/docs/c4pd/increase_storage_size",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/c4pd/increase_storage_size.md",version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Install Db2u oltp on Red Hat Openshift without CP4D",permalink:"/ai/docs/c4pd/install_db2_ocp"},next:{title:"Create OCS storage",permalink:"/ai/docs/c4pd/create_ocs_storage"}},l=[{value:"Check the current storage configuration",id:"check-the-current-storage-configuration",children:[{value:"File system sizes",id:"file-system-sizes",children:[]},{value:"<code>db2ucluster</code> resource configuration",id:"db2ucluster-resource-configuration",children:[]},{value:"SC (Storage class)",id:"sc-storage-class",children:[]},{value:"PVC detail",id:"pvc-detail",children:[]}]},{value:"Increase the size",id:"increase-the-size",children:[]},{value:"MISC.",id:"misc",children:[]}],p={toc:l};function u(e){var n=e.components,t=(0,a.Z)(e,o);return(0,s.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"increase-storage-size"},"Increase storage size"),(0,s.kt)("h2",{id:"check-the-current-storage-configuration"},"Check the current storage configuration"),(0,s.kt)("h3",{id:"file-system-sizes"},"File system sizes"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Find DB2 service pod name         ")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"# oc get pod -A\nNAMESPACE                                          NAME                                                              READY   STATUS      RESTARTS   AGE\n... \nsandy                                              c-db2wh-1659492364975075-db2u-0                                   1/1     Running     0          58m\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Log into the pod and check the file system sizes   ")),(0,s.kt)("p",null,"In this example, ",(0,s.kt)("inlineCode",{parentName:"p"},"/mnt/bludata0")," is almost full and only 48 MB is left.",(0,s.kt)("br",{parentName:"p"}),"\n","The related PVC is  ",(0,s.kt)("inlineCode",{parentName:"p"},"data-c-db2wh-1659492364975075-db2u-0")," .      "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"# oc exec -it c-db2wh-1659492364975075-db2u-0 -- su - db2inst1\n\n[db2inst1@c-db2wh-1659492364975075-db2u-0 - Db2U db2inst1]$ df -TH /mnt/blumeta0/\nFilesystem Type Size\nUsed Avail Use% Mounted on\n172.30.97.139:6789,172.30.116.46:6789,172.30.163.78:6789:/volumes/csi/csi-vol-e294401d-12d0-\n11ed-80cb-0a580a8203d1/d6cba1bb-6e1b-476f-8e92-5bb6131b5bd8 ceph 108G 676M 107G\n1% /mnt/blumeta0\n\n[db2inst1@c-db2wh-1659492364975075-db2u-0 - Db2U db2inst1]$ du -sh\n/mnt/blumeta0/db2/databases/db2inst1/*\n512 /mnt/blumeta0/db2/databases/db2inst1/NODE0000\n\n[db2inst1@c-db2wh-1659492364975075-db2u-0 - Db2U db2inst1]$ df -TH /mnt/bludata0\nFilesystem Type Size Used Avail Use% Mounted on\n/dev/rbd3 ext4 106G 106G 48M 100% /mnt/bludata0      <=======\n\n\nConcerned about `data-c-db2wh-1659492364975075-db2u-0` which shows 48M left.\n")),(0,s.kt)("h3",{id:"db2ucluster-resource-configuration"},(0,s.kt)("inlineCode",{parentName:"h3"},"db2ucluster")," resource configuration"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"$ oc get db2ucluster db2wh-1659492364975075 -o yaml\napiVersion: db2u.databases.ibm.com/v1^M\nkind: Db2uCluster^\n..\n  storage:\n..\n  - name: data\n    spec:\n      accessModes:\n      - ReadWriteOnce\n      resources:\n        requests:\n          storage: 100Gi\n      storageClassName: ocs-storagecluster-ceph-rbd     <====\n    type: template\n..\n")),(0,s.kt)("h3",{id:"sc-storage-class"},"SC (Storage class)"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"# oc get sc\nStorage Class\nNAME                          PROVISIONER                             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE^M\n..\nocs-storagecluster-ceph-rbd   openshift-storage.rbd.csi.ceph.com      Delete          Immediate              true                   168d^M\nocs-storagecluster-cephfs     openshift-storage.cephfs.csi.ceph.com   Delete          Immediate              true                   168d^M\n...\n")),(0,s.kt)("p",null,"Check if ",(0,s.kt)("inlineCode",{parentName:"p"},"AllowVolumeExpansion"),"  is set to ",(0,s.kt)("inlineCode",{parentName:"p"},"True"),".     "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"$ oc describe sc ocs-storagecluster-ceph-rbd\nName:                  ocs-storagecluster-ceph-rbd\nIsDefaultClass:        No\nAnnotations:           description=Provides RWO Filesystem volumes, and RWO and RWX Block volumes\nProvisioner:           openshift-storage.rbd.csi.ceph.com\nParameters:            clusterID=openshift-storage,csi.storage.k8s.io/controller-expand-secret-name=rook-csi-rbd-provisioner,csi.storage.k8s.io/controller-expand-secret-namespace=openshift-storage,csi.storage.k8s.io/fstype=ext4,csi.storage.k8s.io/no\nde-stage-secret-name=rook-csi-rbd-node,csi.storage.k8s.io/node-stage-secret-namespace=openshift-storage,csi.storage.k8s.io/provisioner-secret-name=rook-csi-rbd-provisioner,csi.storage.k8s.io/provisioner-secret-namespace=openshift-storage,imageFeatur\nes=layering,imageFormat=2,pool=ocs-storagecluster-cephblockpool\nAllowVolumeExpansion:  True    <=====\nMountOptions:          <none>\nReclaimPolicy:         Delete\nVolumeBindingMode:     Immediate\nEvents:                <none>\n")),(0,s.kt)("h3",{id:"pvc-detail"},"PVC detail"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"# oc get pvc  \nPersistent Volume Claim\nNAME                                          STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS                  AGE\n..\ndata-c-db2wh-1659492364975075-db2u-0          Bound    pvc-5746314e-32ea-46d4-9937-e1bae65200a3   100Gi      RWO            ocs-storagecluster-ceph-rbd   92d^M\n,,\nactivelogs-c-db2wh-1659492364975075-db2u-0    Bound    pvc-b0d72601-b234-4398-a1e5-421e3efbc40a   100Gi      RWO            ocs-storagecluster-ceph-rbd   92d^M\n..\nc-db2wh-1659492364975075-backup               Bound    pvc-a425f12b-9973-48ee-b752-962fda464f1e   100Gi      RWX            ocs-storagecluster-cephfs     92d^M\nc-db2wh-1659492364975075-meta                 Bound    pvc-6ff7a820-dc5c-4557-bc73-8d7b1ce615f1   100Gi      RWX            ocs-storagecluster-cephfs     92d^M\n..\n")),(0,s.kt)("p",null,"The data PVC is set as 100 GB.     "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'# oc get pvc data-c-db2wh-1659492364975075-db2u-0 -o yaml\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n annotations:\n   formation_id: db2wh-1659492364975075\n   pv.kubernetes.io/bind-completed: "yes"\n   pv.kubernetes.io/bound-by-controller: "yes"\n   storageConfigType: template\n   volume.beta.kubernetes.io/storage-provisioner: openshift-storage.rbd.csi.ceph.com\n creationTimestamp: "2022-08-03T02:08:39Z"\n finalizers:\n - kubernetes.io/pvc-protection\n labels:\n   app: db2wh-1659492364975075\n   component: db2wh\n   db2u/cpdbr: db2u\n   formation_id: db2wh-1659492364975075\n   icpdsupport/addOnId: db2wh\n   icpdsupport/app: db2wh-1659492364975075\n   icpdsupport/createdBy: "1000330999"\n   icpdsupport/podSelector: db2u-log\n   icpdsupport/serviceInstanceId: "1659492364975075"\n   role: db\n   type: engine\n name: data-c-db2wh-1659492364975075-db2u-0\n namespace: cpd\n ownerReferences:\n - apiVersion: db2u.databases.ibm.com/v1\n   kind: Formation\n   name: db2wh-1659492364975075\n   uid: 13331549-de5b-400a-8564-eb296d1362a7\n resourceVersion: "104491131"\n uid: 5746314e-32ea-46d4-9937-e1bae65200a3\nspec:\n accessModes:\n - ReadWriteOnce\n resources:\n   requests:\n     storage: 100Gi   <===\n storageClassName: ocs-storagecluster-ceph-rbd    <===\n volumeMode: Filesystem   <===\n volumeName: pvc-5746314e-32ea-46d4-9937-e1bae65200a3\nstatus:\n accessModes:\n - ReadWriteOnce\n capacity:\n   storage: 100Gi\n phase: Bound\n')),(0,s.kt)("h2",{id:"increase-the-size"},"Increase the size"),(0,s.kt)("p",null,"The change will restart DB2 service pod automatically.",(0,s.kt)("br",{parentName:"p"}),"\n","Therefore, this needs to be done arranging maintenance time.    "),(0,s.kt)("p",null,"The example steps are like below.     "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"- Stop application using DB2 WH. \n- Log into the DB2 pod c-db2wh-1659492364975075-db2u-0 and stop DB2 gracefully.\n\n$ oc exec -it  c-db2wh-1659492364975075-db2u-0 sh\n\n(DB2 Pod terminal)\n\n# as db2uadm user\nwhoami   # Check if the current terminal is db2uadm user.   \nwvcli system stop\n\n# then switch to the user db2inst1\nsu - db2inst1\ndb2 terminate\ndb2 force applications all \ndb2 deactivate db bludb\ndb2stop force\nipclean -a\n\n\n- Change the size in the pvc manually.\n\n$ oc edit pvc data-c-db2wh-1659492364975075-db2u-0\n\nthen manually change the 100Gi to a preferred size.\n\nThe part to change is below one line. \n\n...\nresources:\n   requests:\n     storage: 100Gi    <==== \n...\n\n- Once the change is saved, check if the change is made to the PVC,\n\n$ oc describe pvc data-c-db2wh-1659492364975075-db2u-0\n\n- Monitor if the db2 pod restarts automatically.\n$ oc get pod\n$ oc describe pod c-db2wh-1659492364975075-db2u-0\n\n- Once restarted, check the file system size again logging into the DB2 pod. \n\n$ oc exec -it  c-db2wh-1659492364975075-db2u-0 su - db2inst1\n\n(DB2 pod terminal)\n$ df -TH /mnt/bludata0\n")),(0,s.kt)("h2",{id:"misc"},"MISC."),(0,s.kt)("p",null,"In case SC does not support dynamic change or ",(0,s.kt)("inlineCode",{parentName:"p"},"AllowVolumeExpansio")," is not set, the change may fail.",(0,s.kt)("br",{parentName:"p"}),"\n","NFS SC type is one of example.     "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'error: persistentvolumeclaims "data-c-db2wh-1668719329314611-db2u-0" could not be patched: persistentvolumeclaims "data-c-db2wh-1668719329314611-db2u-0" is forbidden: only dynamically provisioned pvc can be resized and the storageclass that provisions the pvc must support resize\nYou can run `oc replace -f /tmp/oc-edit-mf73x.yaml` to try this update again.\n')))}u.isMDXComponent=!0}}]);